/*
	ã€è£…é¥°å™¨ã€‘
		1.ä¸æ”¹å˜åŸæœ‰åŠŸèƒ½çš„æƒ…å†µä¸Š, ä¸ºå¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½
		2.å¯ä»¥æ’æ‹”å¼çš„ä½¿ç”¨
			å‰ææ˜¯æŠ½è±¡å‡ºæ¥çš„å…¬å…±æ–¹æ³•ï¼ˆæ¯”å¦‚æŠ¥é”™ï¼‰

			æ¯”å¦‚åœ¨å‘é€ ajax è¯·æ±‚ä¹‹å‰, è¦å…ˆæ³¨å…¥ token

			æ¯”å¦‚ç‚¹å‡»æŒ‰é’®æ—¶å€™, æ³¨å…¥ä¸€ä¸ª log çš„æ—¥å¿—å‘é€ç»™åç«¯, è®°å½•ç‚¹å‡»çš„æ—¶é—´, ç”¨æ¥ç»Ÿè®¡ PV UV

*/


// ğŸŒ°ä¾‹å­ä¸€: â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
// ğŸ‘‡ğŸ‘‡éœ€è¦ï¼ï¼ï¼å…ˆåœ¨åº•å±‚çš„åŸå‹é“¾ä¸Šå®šä¹‰ä¸€ä¸‹ ï¼ˆå‰ç½®æ–¹æ³•ï¼‰
Function.prototype.before = function (beforeFn) {
	let _this = this //ä¿å­˜åŸå‡½æ•°

	return function () { 
		// å‰ç½®æ‰§è¡Œ
		beforeFn.apply(this, arguments) //arguments å…ˆæ”¶é›†å‚æ•°, ç„¶åä¼ å…¥ beforeFn, ğŸŒŸğŸŒŸ apply() æ–¹æ³•ç”¨æ¥æ”¹å˜ this æŒ‡å‘

		//æ‰§è¡ŒåŸæœ¬çš„å‡½æ•°
		return _this.apply(this, arguments) //arguments æ”¶é›†å‚æ•°)
	}
}


// ğŸ‘‡ğŸ‘‡éœ€è¦ï¼ï¼å…ˆåœ¨åº•å±‚çš„åŸå‹é“¾ä¸Šå®šä¹‰ä¸€ä¸‹ ï¼ˆåç½®æ–¹æ³•ï¼‰
Function.prototype.after = function (afterFn) {
	let _this = this //ä¿å­˜åŸå‡½æ•°

	return function () { 
		//æ‰§è¡ŒåŸæœ¬çš„å‡½æ•°
		let result = _this.apply(this, arguments) //arguments æ”¶é›†å‚æ•°

		// åç½®æ‰§è¡Œ
		afterFn.apply(this, arguments) //arguments å…ˆæ”¶é›†å‚æ•°, ç„¶åä¼ å…¥ beforeFn, ğŸŒŸğŸŒŸ apply() æ–¹æ³•ç”¨æ¥æ”¹å˜ this æŒ‡å‘

		// è¿”å›åŸæœ¬å‡½æ•°çš„æ‰§è¡Œç»“æœ
		return result

	}
}



// å‡½æ•°
function Test() {
	console.log('666')
	return 666
}

// å®šä¹‰å‡½æ•°çš„è£…é¥°å™¨ï¼ˆå‰ç½®æ‰§è¡Œï¼‰
let test_1 = Test.before(function () {
	console.log('å‰ç½®æ–¹æ³•')
}).after(function () {
	console.log("åç½®æ–¹æ³•")
})

test_1()




// ğŸŒ°ä¾‹å­äºŒï¼ˆä¸ŠæŠ¥æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼‰: â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
const fileBtn = document.querySelector('#fileBtn')

function log () {
	console.log('ä¸ŠæŠ¥ç”¨æˆ· PV UV ç­‰ç”¨æˆ·è®¿é—®è¡Œä¸º')
}

function render() { 
	console.log('æ¸²æŸ“é¡µé¢')
}

// å†™æ³•äºŒ: åœ¨ render ä¹‹å‰æ‰§è¡Œ log, ä¸ŠæŠ¥ç”¨æˆ· PV UV ç­‰ç”¨æˆ·è®¿é—®è¡Œä¸º
render = render.before(log)


fileBtn.addEventListener('click', function() {
	//...å…¶ä»–ä¸šåŠ¡é€»è¾‘
	// log() //å†™æ³•ä¸€: åœ¨ render ä¹‹å‰æ‰§è¡Œ log, ä¸ŠæŠ¥ç”¨æˆ· PV UV ç­‰ç”¨æˆ·è®¿é—®è¡Œä¸º
	render() //æ¸²æŸ“é¡µé¢
	//...å…¶ä»–ä¸šåŠ¡é€»è¾‘
})




// ğŸŒ°ä¾‹å­ä¸‰ï¼ˆå‘é€ ajax è¯·æ±‚ä¹‹å‰, ç»™åç«¯å‘é€  localStorage å†…çš„ç”¨æˆ· token ï¼‰: â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
function ajax(url, method, params) {
	console.log(url, method, params)
}

// âš¡ï¸åˆ‡ç‰‡çš„æ–¹å¼, éœ€è¦ä¼  token çš„é¡µé¢æ‰åŠ  token, ğŸ”¥ğŸ”¥ä¹Ÿå°±æ˜¯éœ€è¦çš„é¡µé¢æ‰è°ƒç”¨ ajax_1 æ–¹æ³•!! ğŸ”¥æ³¨å…¥äº†è·å– token çš„æ–¹æ³•ï¼ä¸ç”¨é‡æ–°å®ç°åŸæœ‰ ajax æ–¹æ³•ï¼
ajax_1 = ajax.before((url, method, params)=>{
	// è·å¾— loaclStorage ä¸­çš„ tokenï¼
	let token = localStorage.getItem('token')
	params.token = token
})

// ğŸ”¥ğŸ”¥ä¸éœ€è¦ä¼ å…¥ token å°±ä½¿ç”¨ ajax æ–¹æ³•ï¼ï¼
ajax('/api', 'post', {
	name: 'jimmy',
})

// ğŸ”¥ğŸ”¥éœ€è¦ä¼ å…¥ token å°±ä½¿ç”¨ ajax_1 æ–¹æ³•ï¼ï¼
ajax_1('/api', 'post', {
	name: 'jimmy',
})

